<script>


    $(function () {
        $("#btnAutEmployee").click(function (e) {

            e.preventDefault();

            if (!formValidate("formAutEmployee")) {
                return;
            };

            $.post('/api/employee', $("#formAutEmployee").serialize(), function (data) {
                $('#addModal').modal('hide');
                swal("Tudo certo!", "Funcionário autorizado com sucesso!", "success");
                loadEmployees();
            }).fail(function () {
                console.log("Rota não encontrada!");
            });

        });

    });

    function loadEmployees() {

        $("#viewEmployees tbody").html("");

        $.getJSON('/api/employees', function (data) {

            data.forEach(element => {

                $("#viewEmployees tbody").append(`
                        <tr>
                            <td>
                                <a href="#edit_${element.idEmployees}" class="btn btn-info btn-sm btn-circle">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="#remove_${element.idEmployees}" class="btn btn-danger btn-sm btn-circle">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </td>
                            <td>${element.desNameF}</td>
                            <td>${element.desNameD}</td>
                            <td><input type="checkbox" class="js-switch checks" data-id="${element.idEmployees}" value="${element.viewProducts}" data-name="viewProducts"/></td>
                            <td><input type="checkbox" class="js-switch checks" data-id="${element.idEmployees}" value="${element.viewOrders}" data-name="viewOrders"/></td>
                            <td><input type="checkbox" class="js-switch checks" data-id="${element.idEmployees}" value="${element.viewEmployees}" data-name="viewEmployees"/></td>
                            <td><input type="checkbox" class="js-switch checks" data-id="${element.idEmployees}" value="${element.viewReports}" data-name="viewReports"/></td>
                            <td><input type="checkbox" class="js-switch checks" data-id="${element.idEmployees}" value="${element.viewConfigs}" data-name="viewConfigs""/></td>
                        </tr>
                    `);
            });

        }).then(() => {

            $(".checks").each(function (index) {
                if ($(this).val() == 1)
                    $(this).prop('checked', true);
            });

            $(".checks").on('change', function () {

                let privileges = {};

                if ($(this).prop('checked') == true) {
                    $(this).val(1)
                    privileges.idEmployee = $(this).data('id');
                    privileges.column = $(this).data('name');
                    privileges.value = $(this).val();

                    //console.log(JSON.stringify(privileges));

                    $.post('/api/privileges/employees', privileges, function (data) {
                    }).fail(function () {
                        console.log("Rota não encontrada!");
                    });

                } else {

                    $(this).val(0)
                    privileges.idEmployee = $(this).data('id');
                    privileges.column = $(this).data('name');
                    privileges.value = $(this).val();

                    //console.log(JSON.stringify(privileges));

                    $.post('/api/privileges/employees', privileges, function (data) {
                    }).fail(function () {
                        console.log("Rota não encontrada!");
                    });
                }

            });

            var elems = Array.prototype.slice.call(document.querySelectorAll('.js-switch'));

            elems.forEach(function (html) {
                var switchery = new Switchery(html, { size: 'small' });
            });

        }).fail(function () {
            console.log("Rota não encontrada!");
        });

    }

    function loadDepartments() {
        $.getJSON('/api/departments/employees', function (data) {

            data.forEach(element => {
                $("#idDepartments").append(`
                    <option value="${element.idDepartment}">${element.desName}</option>
                `);
            });

        }).fail(function () {
            console.log("Rota não encontrada!");
        });
    }

    $(document).ready(function () {
        loadEmployees();
        loadDepartments();

    });

</script>