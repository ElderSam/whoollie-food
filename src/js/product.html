<script>
    var idForm = "formCreateProduct";

    $(function () {
        $("#btnCreateProduct").click(function (e) {
            e.preventDefault();

            if(!formValidate(idForm)) {
                return;
            };

            let form = $(`#${idForm}`);
            let formData = new FormData(form[0]);

            $.ajax({
                type: "POST",
                url: '/api/products',
                data: formData,
                contentType: false,
                processData: false,
                success: function(data) {

                    if(JSON.parse(data).error) {
                        swal("Erro!", JSON.parse(data).message, "error");
                    } else {
                        $('#addModal').modal('hide');
                        swal("Tudo certo!", "Produto adicionado com sucesso!", "success");
                        loadProducts(); 
                        $(`#${idForm}`).trigger("reset");
                    }
                    
                },
                error: function(data) {

                    $(`#${idForm}`).trigger("reset");
                    console.log(`Erro! Mensagem: ${data}`);
               
                }
            });

        });

        $("#btnCancelProduct").click(function() {
            $(`#${idForm}`).trigger("reset");
        });

        loadProducts();
        loadCategoriesProducts();

    });

    function loadProducts() {

        $("#viewProduct").html("");

        $.getJSON('/api/products', function (data) {

            data.forEach(element => {

                //ALTERAR QUANDO IMPLEMENTAR IMAGENS
                $("#viewProduct").append(`
                <div class="col-lg-3"> 
                    <div class="card shadow mb-4 border-left-${element.isActive == 1 ? "success" : "danger"}"> 
                        <div class="card-header py-3"> 
                            <h6 class="m-0 font-weight-bold text-primary float-left"> ${element.desName} </h6>
                            <span class="badge badge-success float-right">R$  ${element.vlUnity} </span>
                        </div>
                        <div class="card-body text-center">
                            <img class="fluid-img mb-1" src="/${element.desImagePath}" alt="" style="width: 100px; height: 100px;">
                            <p> ${((element.desNote == "") ? "Produto sem descrição." : element.desNote)} </p>
                            <a href="#" class="btn btn-info btn-circle">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="#" class="btn btn-danger btn-circle">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </div>
                </div>`);
            });

        }).fail(function () {
            console.log("Rota não encontrada!");
        });
    }

    function loadCategoriesProducts() {
        $.getJSON('/api/categories/products', function (data) {

        data.forEach(element => {
            $("#idProductCategory").append(`
                <option value="${element.idProductCategory}">${element.desName}</option>
            `);
        });

        }).fail(function () {
            console.log("Rota não encontrada!");
        });
    }

</script>